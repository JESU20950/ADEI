# Load Required Packages: to be increased over the course
options(contrasts=c("contr.treatment","contr.treatment"))
requiredPackages <- c("missMDA","chemometrics","mvoutlier","effects","FactoMineR","car", "factoextra","RColorBrewer","ggplot2","dplyr","ggmap","ggthemes","knitr","ggpubr", "corrplot", "rmarkdown", "tinytex")
missingPackages <- requiredPackages[!(requiredPackages %in% installed.packages()[,"Package"])]
if(length(missingPackages)) install.packages(missingPackages)
lapply(requiredPackages, require, character.only = TRUE)
# Clear plots
if(!is.null(dev.list())) dev.off()
# Clean workspace
rm(list=ls())
#setwd("C:/Users/carle/Desktop/ADEI2")
#filepath<-"C:/Users/carle/Desktop/ADEI2/"
setwd("~/Desktop/ADEI/Labs/DeliverableII")
# Load Required Packages: to be increased over the course
options(contrasts=c("contr.treatment","contr.treatment"))
requiredPackages <- c("missMDA","chemometrics","mvoutlier","effects","FactoMineR","car", "factoextra","RColorBrewer","ggplot2","dplyr","ggmap","ggthemes","knitr","ggpubr", "corrplot", "moments","rmarkdown", "tinytex")
missingPackages <- requiredPackages[!(requiredPackages %in% installed.packages()[,"Package"])]
if(length(missingPackages)) install.packages(missingPackages)
lapply(requiredPackages, require, character.only = TRUE)
library(MASS)
par(mfrow=c(1,2))
boxcox(Total_amount ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
# Load Required Packages: to be increased over the course
options(contrasts=c("contr.treatment","contr.treatment"))
requiredPackages <- c("missMDA","chemometrics","mvoutlier","effects","FactoMineR","car", "factoextra","RColorBrewer","ggplot2","dplyr","ggmap","ggthemes","knitr","ggpubr", "corrplot", "moments","rmarkdown", "tinytex")
missingPackages <- requiredPackages[!(requiredPackages %in% installed.packages()[,"Package"])]
if(length(missingPackages)) install.packages(missingPackages)
lapply(requiredPackages, require, character.only = TRUE)
# Clear plots
if(!is.null(dev.list())) dev.off()
# Clean workspace
rm(list=ls())
#setwd("C:/Users/carle/Desktop/ADEI2")
#filepath<-"C:/Users/carle/Desktop/ADEI2/"
setwd("~/Desktop/ADEI/Labs/DeliverableIII")
# Load Required Packages: to be increased over the course
options(contrasts=c("contr.treatment","contr.treatment"))
requiredPackages <- c("missMDA","chemometrics","mvoutlier","effects","FactoMineR","car", "factoextra","RColorBrewer","ggplot2","dplyr","ggmap","ggthemes","knitr","ggpubr", "corrplot", "moments","rmarkdown", "tinytex")
missingPackages <- requiredPackages[!(requiredPackages %in% installed.packages()[,"Package"])]
if(length(missingPackages)) install.packages(missingPackages)
lapply(requiredPackages, require, character.only = TRUE)
# Clear plots
if(!is.null(dev.list())) dev.off()
# Clean workspace
rm(list=ls())
#setwd("C:/Users/carle/Desktop/ADEI2")
#filepath<-"C:/Users/carle/Desktop/ADEI2/"
setwd("~/Desktop/ADEI/Labs/DeliverableIII")
setwd("C:/Users/Prestec/Desktop/ADEI/Labs/DeliverableIII")
setwd("C:/Users/Prestec/Desktop/ADEI/Labs/DeliverableIII")
df <- read.table("Deliverable1.csv",header=T, sep=",");
vars_dis <- c("VendorID", "Payment_type", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date", "multiouts", "f.espeed", "f.tlenkm", "f.traveltime", "f.distHaversine", "AnyToll", "f.Fare_amount", "f.Passenger_count", "f.Total_amount")
vars_con <- c( "Passenger_count", "tlenkm", "Pickup_longitude", "Pickup_latitude", "Dropoff_longitude", "Dropoff_latitude","Fare_amount", "espeed", "Tip_amount", "Tolls_amount", "lpep_pickup_time", "traveltime", "distHaversine")
for( i in vars_dis){
df[,i] <- as.factor(df[,i])
}
vars_res <- c("AnyTip", "Total_amount")
d1 <- dim(df)[1]
d2 <- dim(df)[2]
df[,d2-1] <- as.factor(df[,d2-1])
vars_cexp<-c("Passenger_count", "tlenkm", "Fare_amount", "espeed", "Tip_amount", "Tolls_amount", "lpep_pickup_time", "traveltime", "distHaversine")
hist(df$Total_amount, 70, freq=F)
mn <- mean(df$Total_amount); ss <- sd(df$Total_amount)
curve(dnorm(x, mean = mn,sd= ss), lwd=2, lty=3, add=T)
shapiro.test(df$Total_amount)
skewness(df$Total_amount)  # Normal data should 0 - Right skewed data is present
kurtosis(df$Total_amount)  # Normal data should 3 - 5.35 >> 3
round(cor(df[,c("Total_amount",vars_cexp)], method="spearman"),dig=2)
round(cor(df[,c("Total_amount",vars_cexp)], method="pearson"),dig=2)
m <- lm( Total_amount~., data=df[,c("Total_amount",vars_cexp)])
summary(m)
Anova(m)
vif(m)  # Check association between explanatory vars
m <- step( m, k=log(nrow(df)) )
#
m <- lm( Total_amount ~ tlenkm + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine, data=df[,c("Total_amount",vars_cexp)])
Anova(m)
#marginalModelPlots(m)
m2 <-lm(Total_amount ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
summary(m2)
Anova(m2)
vif(m2)
#marginalModelPlots(m2)
par(mfrow=c(2,2))
plot(m, id.n=0)
par(mfrow=c(1,1))
l <- which(df$Total_amount == 0 )
df[l,'Total_amount'] <- 0.0001
m3 <- lm( log(Total_amount) ~ poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine, data=df)
summary(m3)
m3 <- lm( log(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount +
lpep_pickup_time, data=df)
summary(m3)
Anova(m3)
vif(m3)
#marginalModelPlots(m3)
BIC(m,m2,m3)
library(MASS)
par(mfrow=c(1,2))
boxcox(Total_amount ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
boxcox(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
par(mfrow=c(1,1))
m4<-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
summary(m4)
Anova(m4)
vif(m4)
par(mfrow=c(2,2))
plot( m4, id.n=0 )
par(mfrow=c(1,1))
summary(resid(m4))
sel1<-Boxplot(rstudent(m4));sel1 # sel1 already contains row numbers
# ll1<-which(row.names(df) %in% names(rstudent(m25)[sel1]));ll1
sel2<-which(hatvalues(m4)>6*length(m4$coefficients)/nrow(df));sel2;length(sel2) # sel2 contains row names
ll2<-which(row.names(df) %in% names(hatvalues(m4)[sel2]));ll2
sel3<-which(abs(cooks.distance(m4))>4/(nrow(df)-length(m4$coefficients)));sel3;length(sel3)
ll3<-which(row.names(df) %in% names(cooks.distance(m4)[sel3]));ll3
# sel4<-Boxplot(cooks.distance(m25));sel4  # sel4 already contains row numbers
sel3<-which((cooks.distance(m4))>0.1);sel3;length(sel3)# sel3 contains row names
ll3<-which(row.names(df) %in% names(cooks.distance(m4)[sel3]));ll3
influencePlot(m4,id=list(method="noteworthy", n=5, cex=0.5))
with(df,tapply(Total_amount,RateCodeID,summary))
m30<-lm(log(Total_amount) ~  Extra + Tip_amount + Tolls_amount + improvement_surcharge + espeed + log(tlenkm)  ,data=df)
# Load Required Packages: to be increased over the course
options(contrasts=c("contr.treatment","contr.treatment"))
requiredPackages <- c("missMDA","chemometrics","mvoutlier","effects","FactoMineR","car", "factoextra","RColorBrewer","ggplot2","dplyr","ggmap","ggthemes","knitr","ggpubr", "corrplot", "moments","rmarkdown", "tinytex","effects")
missingPackages <- requiredPackages[!(requiredPackages %in% installed.packages()[,"Package"])]
if(length(missingPackages)) install.packages(missingPackages)
lapply(requiredPackages, require, character.only = TRUE)
m4<-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
summary(m4)
Anova(m4)
vif(m4)
par(mfrow=c(2,2))
plot( m4, id.n=0 )
par(mfrow=c(1,1))
plot(allEffects(m4))
m4<-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
summary(m4)
Anova(m4)
vif(m4)
par(mfrow=c(2,2))
plot( m4, id.n=0 )
par(mfrow=c(1,1))
plot(allEffects(m4))
plot(allEffects(m4))
View(m4)
View(df)
m4<-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
Anova(m4)
vif(m4)
vars_con
vars_dis
m4<-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m5 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine + f.Extra + AnyToll ,data=df)
BIC(m4,m5)
BIC(m4)
BIC(m1, m2, m3, m4)
BIC(m, m2, m3, m4)
BIC(m4,m5)
m4<-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m5 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine + f.Extra + AnyToll ,data=df)
m6 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + f.distHaversine + f.Extra + AnyToll ,data=df)
BIC(m4,m5,m6)
m4<-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m5 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine + f.Extra + AnyToll ,data=df)
m6 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + f.distHaversine + f.Extra + AnyToll ,data=df)
BIC(m4,m5,m6)
m4<-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m5 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine + f.Extra + AnyToll ,data=df)
m6 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + f.distHaversine + f.Extra + AnyToll ,data=df)
m7 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + f.distHaversine + f.Extra + AnyToll ,data=df)
BIC(m4,m5,m6,m7)
m4<-lm(log(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m5 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine + f.Extra + AnyToll ,data=df)
m6 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + f.distHaversine + f.Extra + AnyToll ,data=df)
BIC(m4,m5,m6,m7)
vars_con
m4<-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m5 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine + f.Extra + AnyToll ,data=df)
m6 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + f.distHaversine + f.Extra + AnyToll ,data=df)
m4<-lm(log(Total_amount) ~  log(tlenkm) + Tip_amount + Tolls_amount + espeed + Fare_amount,data=df)
BIC(m4,m5,m6,m7)
m4<-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m5 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine + f.Extra + AnyToll ,data=df)
m6 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + f.distHaversine + f.Extra + AnyToll ,data=df)
m6 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + f.espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + f.distHaversine + f.Extra + AnyToll ,data=df)
BIC(m4,m5,m6,m7)
m4<-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m5 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine + f.Extra + AnyToll ,data=df)
m6 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + f.distHaversine + f.Extra + AnyToll ,data=df)
m6 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + f.Tip_amount + Tolls_amount +
lpep_pickup_time + f.distHaversine + f.Extra + AnyToll ,data=df)
vars_dis
m4<-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m41 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m42 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + f.espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m43 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + f.Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m4<-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m41 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m42 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + f.espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m43 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + AnyTip + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m44 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + AnyTollt +
lpep_pickup_period + distHaversine,data=df)
m4<-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m41 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m42 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + f.espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m43 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + AnyTip + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m44 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + AnyToll +
lpep_pickup_period + distHaversine,data=df)
m45 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + AnyTollt +
lpep_pickup_time + f.distHaversine,data=df)
m4<-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m41 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m42 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + f.espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m43 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + AnyTip + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m44 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + AnyToll +
lpep_pickup_time + distHaversine,data=df)
m45 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + AnyToll +
lpep_pickup_period + distHaversine,data=df)
m46 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + AnyToll +
lpep_pickup_time + f.distHaversine,data=df)
BIC(m4,m41,m42,m43,m44,m45,m46)
m4<-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m41 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m42 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + f.espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m43 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + AnyTip + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m44 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + AnyToll +
lpep_pickup_time + distHaversine,data=df)
m45 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + AnyToll +
lpep_pickup_period + distHaversine,data=df)
m46 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + AnyToll +
lpep_pickup_time + f.distHaversine,data=df)
m47 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + f.espeed + AnyTip + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
BIC(m4,m41,m42,m43,m44,m45,m46,m47)
m4<-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m41 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m42 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + f.espeed + Tip_amount + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m43 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + Fare_amount + espeed + AnyTip + Tolls_amount +
lpep_pickup_time + distHaversine,data=df)
m44 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + AnyToll +
lpep_pickup_time + distHaversine,data=df)
m45 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + AnyToll +
lpep_pickup_period + distHaversine,data=df)
m46 <-lm(sqrt(Total_amount) ~  poly(tlenkm,2) + f.Fare_amount + espeed + Tip_amount + AnyToll +
lpep_pickup_time + f.distHaversine,data=df)
BIC(m4,m41,m42,m43,m44,m45,m46)
marginalModelPlots(m4)
