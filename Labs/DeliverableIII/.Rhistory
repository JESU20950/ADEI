summary(m3)
vif(m3)
m2<-glm(AnyTip~tlenkm+Pickup_longitude+ Dropoff_longitude+ tlenkm + distHaversine ,family="binomial",data=train_dataset)
summary(m2)
vif(m2)
step( m2, k=log(nrow(df)))
m3<-glm(AnyTip~tlenkm+Pickup_longitude+distHaversine ,family="binomial",data=train_dataset)
summary(m3)
vif(m3)
m3<-glm(AnyTip~tlenkm+Pickup_longitude+distHaversine ,family="binomial",data=train_dataset)
summary(m3)
vif(m3)
step( m3, k=log(nrow(df)))
m3<-glm(AnyTip~tlenkm+Pickup_longitude+distHaversine ,family="binomial",data=train_dataset)
summary(m3)
vif(m3)
BIC(m,m2,m3)
m2<-glm(AnyTip~tlenkm+Pickup_longitude+ Dropoff_longitude + distHaversine ,family="binomial",data=train_dataset)
summary(m2)
vif(m2)
step( m2, k=log(nrow(df)))
m3<-glm(AnyTip~tlenkm+Pickup_longitude+ Dropoff_longitude + distHaversine,family="binomial",data=train_dataset)
summary(m3)
vif(m3)
m3<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine,family="binomial",data=train_dataset)
summary(m3)
vif(m3)
m3<-glm(AnyTip~poly(tlenkm,2)+Pickup_longitude + distHaversine,family="binomial",data=train_dataset)
summary(m3)
vif(m3)
m3<-glm(AnyTip~poly(tlenkm,2)+Pickup_longitude + distHaversine,family="binomial",data=train_dataset)
summary(m3)
vif(m3)
Annova(m3)
m3<-glm(AnyTip~poly(tlenkm,2)+Pickup_longitude + distHaversine,family="binomial",data=train_dataset)
summary(m3)
vif(m3)
Anova(m3,test="Wald")
m2<-glm(AnyTip~tlenkm+Pickup_longitude+ Dropoff_longitude + distHaversine ,family="binomial",data=train_dataset)
summary(m2)
vif(m2)
Anova(m2,test="Wald")
m3<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine,family="binomial",data=train_dataset)
summary(m3)
vif(m3)
Anova(m3,test="Wald")
m3<-glm(AnyTip~poly(tlenkm,2)+Pickup_longitude + distHaversine,family="binomial",data=train_dataset)
summary(m3)
vif(m3)
Anova(m3,test="Wald")
m2<-glm(AnyTip~poly(tlenkm,2)+Pickup_longitude+ Dropoff_longitude + distHaversine ,family="binomial",data=train_dataset)
summary(m2)
vif(m2)
Anova(m2,test="Wald")
m3<-glm(AnyTip~poly(tlenkm,2)+Pickup_longitude + distHaversine + ,family="binomial",data=train_dataset)
m3<-glm(AnyTip~poly(tlenkm,2)+Pickup_longitude + distHaversine ,family="binomial",data=train_dataset)
summary(m3)
vif(m3)
Anova(m3,test="Wald")
step( m3, k=log(nrow(df)))
m2<-glm(AnyTip~tlenkm+Pickup_longitude+ Dropoff_longitude + distHaversine ,family="binomial",data=train_dataset)
summary(m2)
vif(m2)
Anova(m2,test="Wald")
plot(allEffects(m52))
m3<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine ,family="binomial",data=train_dataset)
summary(m3)
vif(m3)
Anova(m3,test="Wald")
m3<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine ,family="binomial",data=train_dataset)
summary(m3)
Anova(m3,test="Wald")
m3<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine ,family="binomial",data=train_dataset)
summary(m3)
plot(allEffects(m2))
plot(allEffects(m3))
marginalModelPlots(m3)
residualPlots(m3)
summary(m3)
marginalModelPlots(m3)
residualPlots(m3)
residualPlots(m3)
residualPlots(m3)
sumary(df[,vars_dis])
sumary(df[,vars_dis])
summary(df[,vars_dis])
summary(df[,c("VendorID", "Payment_type", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date")])
summary(df[,c("VendorID", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date")])
m41<-glm(AnyTip~f.tlenkm+Pickup_longitude + distHaversine ,family="binomial",data=train_dataset)
m42<-glm(AnyTip~tlenkm+Pickup_longitude + f.distHaversine ,family="binomial",data=train_dataset)
m43<-glm(AnyTip~tlenkm+Pickup_longitude + f.distHaversine ,family="binomial",data=train_dataset)
summary(m3)
m41<-glm(AnyTip~f.tlenkm+Pickup_longitude + distHaversine ,family="binomial",data=train_dataset)
m42<-glm(AnyTip~tlenkm+f.Pickup_longitude + f.distHaversine ,family="binomial",data=train_dataset)
m41<-glm(AnyTip~f.tlenkm+Pickup_longitude + distHaversine ,family="binomial",data=train_dataset)
m42<-glm(AnyTip~tlenkm+Pickup_longitude + f.distHaversine ,family="binomial",data=train_dataset)
summary(m41)
m41<-glm(AnyTip~f.tlenkm+Pickup_longitude + distHaversine ,family="binomial",data=train_dataset)
m42<-glm(AnyTip~tlenkm+Pickup_longitude + f.distHaversine ,family="binomial",data=train_dataset)
summary(m41)
summary(m42)
m41<-glm(AnyTip~f.tlenkm+Pickup_longitude + distHaversine ,family="binomial",data=train_dataset)
m42<-glm(AnyTip~tlenkm+Pickup_longitude + f.distHaversine ,family="binomial",data=train_dataset)
summary(m41)
summary(m42)
m41<-glm(AnyTip~f.tlenkm+Pickup_longitude + distHaversine ,family="binomial",data=train_dataset)
m42<-glm(AnyTip~tlenkm+Pickup_longitude + f.distHaversine ,family="binomial",data=train_dataset)
summary(m41)
summary(m42)
BIC(m41,m42)
m41<-glm(AnyTip~f.tlenkm+Pickup_longitude + distHaversine ,family="binomial",data=train_dataset)
m42<-glm(AnyTip~tlenkm+Pickup_longitude + f.distHaversine ,family="binomial",data=train_dataset)
summary(m41)
summary(m42)
BIC(m3,m41,m42)
m41<-glm(AnyTip~f.tlenkm+Pickup_longitude + distHaversine ,family="binomial",data=train_dataset)
m42<-glm(AnyTip~tlenkm+Pickup_longitude + f.distHaversine ,family="binomial",data=train_dataset)
summary(m41)
summary(m42)
BIC(m3,m41,m42)
summary(df[,c("VendorID", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date")])
m41<-glm(AnyTip~f.tlenkm+Pickup_longitude + distHaversine +f.Extra+f.MTA_tax   ,family="binomial",data=train_dataset)
summary(df[,c("VendorID", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date")])
m5<-glm(AnyTip~f.tlenkm+Pickup_longitude + distHaversine +f.Extra+f.MTA_tax   ,family="binomial",data=train_dataset)
summary(df[,c("VendorID", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date")])
m5<-glm(AnyTip~f.tlenkm+Pickup_longitude + distHaversine +f.Extra+f.MTA_tax   ,family="binomial",data=train_dataset)
summary(m5)
summary(df[,c("VendorID", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date")])
m5<-glm(AnyTip~f.tlenkm+Pickup_longitude + distHaversine +f.Extra+f.MTA_tax   ,family="binomial",data=train_dataset)
summary(m5)
vif(m5)
Anova(m5,test="Wald")
summary(df[,c("VendorID", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date")])
m5<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine +f.Extra+f.MTA_tax   ,family="binomial",data=train_dataset)
summary(m5)
vif(m5)
Anova(m5,test="Wald")
res.cat <- catdes(df,num.var=which(names(df)=="AnyTip"))
res.cat$quanti.var
res.cat$quanti
res.cat$test.chi2
res.cat$category
summary(df[,c("VendorID", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date")])
m5<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine +f.Extra+f.MTA_tax   ,family="binomial",data=train_dataset)
summary(m5)
vif(m5)
Anova(m5,test="Wald")
res.cat <- catdes(df,num.var=which(names(df)=="AnyTip"))
res.cat$quanti.var
res.cat$quanti
res.cat$test.chi2
res.cat$category
#summary(df[,c("VendorID", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date")])
#m5<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine +f.Extra+f.MTA_tax   ,family="binomial",data=train_dataset)
#summary(m5)
#vif(m5)
#Anova(m5,test="Wald")
res.cat <- catdes(df,num.var=which(names(df)=="AnyTip"))
res.cat$quanti.var
res.cat$quanti
res.cat$test.chi2
res.cat$category
#summary(df[,c("VendorID", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date")])
#m5<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine +f.Extra+f.MTA_tax   ,family="binomial",data=train_dataset)
#summary(m5)
#vif(m5)
#Anova(m5,test="Wald")
res.cat <- catdes(df,num.var=which(names(df)=="AnyTip"))
res.cat$quanti.var
res.cat$quanti
res.cat$test.chi2
res.cat$category
#summary(df[,c("VendorID", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date")])
#m5<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine +f.Extra+f.MTA_tax   ,family="binomial",data=train_dataset)
#summary(m5)
#vif(m5)
#Anova(m5,test="Wald")
res.cat <- catdes(df,num.var=which(names(df)=="AnyTip"))
res.cat$quanti.var
res.cat$quanti
res.cat$test.chi2
res.cat$category
#summary(df[,c("VendorID", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date")])
#m5<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine +f.Extra+f.MTA_tax   ,family="binomial",data=train_dataset)
#summary(m5)
#vif(m5)
#Anova(m5,test="Wald")
res.cat <- catdes(df,num.var=which(names(df)=="AnyTip"))
res.cat$quanti
res.cat$test.chi2
res.cat$category
#summary(df[,c("VendorID", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date")])
#m5<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine +f.Extra+f.MTA_tax   ,family="binomial",data=train_dataset)
#summary(m5)
#vif(m5)
#Anova(m5,test="Wald")
res.cat <- catdes(df,num.var=which(names(df)=="AnyTip"))
res.cat$test.chi2
res.cat$category
#summary(df[,c("VendorID", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date")])
#m5<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine +f.Extra+f.MTA_tax   ,family="binomial",data=train_dataset)
#summary(m5)
#vif(m5)
#Anova(m5,test="Wald")
res.cat <- catdes(df,num.var=which(names(df)=="AnyTip"))
res.cat$test.chi2
#summary(df[,c("VendorID", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date")])
#m5<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine +f.Extra+f.MTA_tax   ,family="binomial",data=train_dataset)
#summary(m5)
#vif(m5)
#Anova(m5,test="Wald")
res.cat <- catdes(df,num.var=which(names(df)=="AnyTip"))
res.cat$test.chi2
summary(df[  "RateCodeID",f.Extra, lpep_pickup_period,  "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date")])
summary(df[  ,c("RateCodeID","f.Extra", "lpep_pickup_period",  "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date")])
#m5<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine +f.Extra+f.MTA_tax   ,family="binomial",data=train_dataset)
#summary(m5)
#vif(m5)
#Anova(m5,test="Wald")
vars_cexp <- c("f.Improvement_surcharge","f.MTA_tax", "Trip_type", "RateCodeID","lpep_pickup_period", "VendorID", "lpep_pickup_date",  "f.Extra")
summary(df[, vars_cexp])
#m5<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine +f.Extra+f.MTA_tax   ,family="binomial",data=train_dataset)
#summary(m5)
#vif(m5)
#Anova(m5,test="Wald")
vars_cexp <- c("f.Improvement_surcharge","f.MTA_tax", "Trip_type", "RateCodeID","lpep_pickup_period", "VendorID", "lpep_pickup_date",  "f.Extra")
summary(df[, vars_cexp])
m5<-glm(AnyTip~. ,family="binomial",data=train_dataset[,vars_cexp])
vars_cexp <- c("f.Improvement_surcharge","f.MTA_tax", "Trip_type", "RateCodeID","lpep_pickup_period", "VendorID", "lpep_pickup_date",  "f.Extra")
summary(df[, vars_cexp])
m5<-glm(AnyTip~. ,family="binomial",data=train_dataset[,c("AnyTip", vars_cexp)])
summary(m5)
vif(m5)
Anova(m5,test="Wald")
vars_cexp_cat <- c("f.Improvement_surcharge","f.MTA_tax", "Trip_type", "RateCodeID","lpep_pickup_period", "VendorID", "lpep_pickup_date",  "f.Extra")
m5<-glm(AnyTip~. ,family="binomial",data=train_dataset[,c("AnyTip", vars_cexp_cat)])
summary(m5)
vif(m5)
Anova(m5,test="Wald")
# Load Required Packages: to be increased over the course
options(contrasts=c("contr.treatment","contr.treatment"))
requiredPackages <- c("missMDA","chemometrics","mvoutlier","effects","FactoMineR","car", "factoextra","RColorBrewer","ggplot2","dplyr","ggmap","ggthemes","knitr","ggpubr", "corrplot", "moments","rmarkdown", "tinytex","effects")
missingPackages <- requiredPackages[!(requiredPackages %in% installed.packages()[,"Package"])]
if(length(missingPackages)) install.packages(missingPackages)
lapply(requiredPackages, require, character.only = TRUE)
# Clear plots
if(!is.null(dev.list())) dev.off()
# Clean workspace
rm(list=ls())
#setwd("C:/Users/carle/Desktop/ADEI2")
#filepath<-"C:/Users/carle/Desktop/ADEI2/"
setwd("C:/Users/jesus/Desktop/ADEI/Labs/DeliverableIII")
df <- read.table("Deliverable1.csv",header=T, sep=",");
vars_dis <- c("VendorID", "Payment_type", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date", "multiouts", "f.espeed", "f.tlenkm", "f.traveltime", "f.distHaversine", "AnyToll", "f.Fare_amount", "f.Passenger_count", "f.Total_amount")
vars_con <- c( "Passenger_count", "tlenkm", "Pickup_longitude", "Pickup_latitude", "Dropoff_longitude", "Dropoff_latitude","Fare_amount", "espeed", "Tip_amount", "Tolls_amount", "lpep_pickup_time", "traveltime", "distHaversine")
for( i in vars_dis){
df[,i] <- as.factor(df[,i])
}
vars_res <- c("AnyTip", "Total_amount")
d1 <- dim(df)[1]
d2 <- dim(df)[2]
df[,d2-1] <- as.factor(df[,d2-1])
vars_cexp<-c("Passenger_count", "tlenkm", "Fare_amount", "espeed", "Tolls_amount", "lpep_pickup_time", "traveltime", "distHaversine")
# Split your sample: work and test
l<-which(df$Payment_type=="f.PayType-Cash");
dff<-df[-l,]
set.seed(12345)
l<-sample(1:nrow(dff),0.70*nrow(dff),replace=FALSE)
l<-sort(l);
train_dataset<-dff[l,]
test_dataset<-dff[-l,]
m<-glm(AnyTip~.,family="binomial",data=train_dataset[,c("AnyTip",vars_cexp)])
summary(m)
Anova(m,test="Wald")
vif(m)
res.cat <- catdes(train_dataset,num.var=which(names(df)=="AnyTip"))
res.cat$quanti.var
m2<-glm(AnyTip~tlenkm+Pickup_longitude+ Dropoff_longitude + distHaversine ,family="binomial",data=train_dataset)
summary(m2)
vif(m2)
Anova(m2,test="Wald")
m3<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine ,family="binomial",data=train_dataset)
summary(m3)
plot(allEffects(m3))
marginalModelPlots(m3)
residualPlots(m3)
m41<-glm(AnyTip~f.tlenkm+Pickup_longitude + distHaversine ,family="binomial",data=train_dataset)
m42<-glm(AnyTip~tlenkm+Pickup_longitude + f.distHaversine ,family="binomial",data=train_dataset)
summary(m41)
summary(m42)
BIC(m3,m41,m42)
res.cat <- catdes(df,num.var=which(names(df)=="AnyTip"))
res.cat$test.chi2
vars_cexp_cat <- c("f.Improvement_surcharge","f.MTA_tax", "Trip_type", "RateCodeID","lpep_pickup_period", "VendorID", "lpep_pickup_date",  "f.Extra")
m5<-glm(AnyTip~. ,family="binomial",data=train_dataset[,c("AnyTip", vars_cexp_cat)])
summary(m5)
vif(m5)
Anova(m5,test="Wald")
# Consider to deal with some of the current variables as factors: Extra and MTA_tax
m60<-glm(AnyTip~poly(tlenkm,2)+Extra+MTA_tax, family="binomial", data=train_dataset)
vars_cexp_cat <- c("f.Improvement_surcharge","f.MTA_tax", "Trip_type", "RateCodeID","lpep_pickup_period", "VendorID", "lpep_pickup_date",  "f.Extra")
m5<-glm(AnyTip~. ,family="binomial",data=train_dataset[,c("AnyTip", vars_cexp_cat)])
vif(m5)
m6<-glm(AnyTip~f.MTA_tax+lpep_pickup_period+VendorID+lpep_pickup_date+f.Extra,family="binomial",data=train_dataset)
vif(m6)
m6<-glm(AnyTip~f.MTA_tax+lpep_pickup_period+VendorID+lpep_pickup_date+f.Extra,family="binomial",data=train_dataset)
vif(m6)
summary(m6)
m6<-glm(AnyTip~f.MTA_tax+lpep_pickup_period+VendorID+lpep_pickup_date+f.Extra,family="binomial",data=train_dataset)
vif(m6)
Anova(m6,test="Wald")
m6<-glm(AnyTip~f.MTA_tax+lpep_pickup_period+f.Extra,family="binomial",data=train_dataset)
vif(m6)
Anova(m6,test="Wald")
m6<-glm(AnyTip~f.MTA_tax+lpep_pickup_period+f.Extra,family="binomial",data=train_dataset)
vif(m6)
Anova(m6,test="Wald")
m6<-glm(AnyTip~f.MTA_tax+lpep_pickup_period+f.Extra,family="binomial",data=train_dataset)
vif(m6)
Anova(m6,test="Wald")
summary(m6)
m6<-glm(AnyTip~f.MTA_tax+lpep_pickup_period+f.Extra,family="binomial",data=train_dataset)
summary(m6)
summary(m6)
summary(m6)
m6<-glm(AnyTip~f.MTA_tax+lpep_pickup_period+f.Extra,family="binomial",data=train_dataset)
summary(m6)
step(m6, k=log(nrow(df)))
m6<-glm(AnyTip~f.MTA_tax+lpep_pickup_period+f.Extra,family="binomial",data=train_dataset)
step(m6, k=log(nrow(df)))
m6<-glm(AnyTip~f.MTA_tax+lpep_pickup_period+f.Extra,family="binomial",data=train_dataset)
step(m6, k=log(nrow(df)))
summary(m6)
m6<-glm(AnyTip~f.MTA_tax+lpep_pickup_period+VendorID+lpep_pickup_date+f.Extra,family="binomial",data=train_dataset)
vif(m6)
Anova(m6,test="Wald")
m6<-glm(AnyTip~tlenkm+Pickup_longitude + distHaversine +(f.MTA_tax+lpep_pickup_period+VendorID+lpep_pickup_date+f.Extra),family="binomial",data=train_dataset)
vif(m6)
Anova(m6,test="Wald")
m7<-glm(AnyTip~ (tlenkm+Pickup_longitude + distHaversine)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
vif(m7)
summary(m7)
# Extra no pot estar com numèrica i factor simultàniament en el model
m7<-glm(AnyTip~ (tlenkm+Pickup_longitude + distHaversine)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
vif(m7)
Anova(m7,test="Wald"))
m7<-glm(AnyTip~ (tlenkm+Pickup_longitude + distHaversine)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
vif(m7)
Anova(m7,test="Wald")
m7<-glm(AnyTip~ (poly(tlenkm,2)+Pickup_longitude + distHaversine)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
vif(m7)
Anova(m7,test="Wald")
m7<-glm(AnyTip~ (tlenkm+Pickup_longitude + distHaversine)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
vif(m7)
Anova(m7,test="Wald")
m7<-glm(AnyTip~ (poly(tlenkm,2)+Pickup_longitude + distHaversine)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
vif(m7)
Anova(m7,test="Wald")
m7<-glm(AnyTip~ (poly(tlenkm,2)+Pickup_longitude + distHaversine)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
m72<-glm(AnyTip~ (tlenkm+Pickup_longitude + poly(distHaversine,2))+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
vif(m7)
Anova(m7,test="Wald")
Anova(m72,test="Wald")
m7<-glm(AnyTip~ (poly(tlenkm,2)+Pickup_longitude+DistHaversine)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
m7<-glm(AnyTip~ (poly(tlenkm,2)+Pickup_longitude+distHaversine)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
m7<-glm(AnyTip~ (poly(tlenkm,2)+Pickup_longitude+distHaversine)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
vif(m7)
summary(m7)
m7<-glm(AnyTip~ (tlenkm+Pickup_longitude+distHaversine)*(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
vif(m7)
m7<-glm(AnyTip~ (tlenkm+Pickup_longitude+distHaversine)*(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
vif(m7)
summary(m7)
m7<-glm(AnyTip~ (tlenkm+Pickup_longitude+distHaversine)*(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
vif(m7)
summary(m7)
Anova(m7,test="Wald")
m7<-glm(AnyTip~ (tlenkm+Pickup_longitude+distHaversine)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
vif(m7)
summary(m7)
Anova(m7,test="Wald")
m7<-glm(AnyTip~ (tlenkm+Pickup_longitude+distHaversine)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
m71<-glm(AnyTip~ (tlenkm+Pickup_longitude+distHaversine)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
vif(m7)
vif(m71)
summary(m7)
summary(m71)
Anova(m7,test="Wald")
Anova(m71,test="Wald")
m7<-glm(AnyTip~ (tlenkm+Pickup_longitude+distHaversine)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
m71<-glm(AnyTip~ (poly(tlenkm,2)+Pickup_longitude+distHaversine)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
vif(m7)
vif(m71)
summary(m7)
summary(m71)
Anova(m7,test="Wald")
Anova(m71,test="Wald")
m7<-glm(AnyTip~ (tlenkm+Pickup_longitude+distHaversine)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
m71<-glm(AnyTip~ (poly(tlenkm,2)+Pickup_longitude+distHaversine)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
vif(m7)
vif(m71)
Anova(m7,test="Wald")
Anova(m71,test="Wald")
m8<-glm(AnyTip~ (poly(tlenkm,2)+Pickup_longitude)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
Anova(m8,test="Wald")
m81<-glm(AnyTip~ (poly(tlenkm,2)+Pickup_longitude)*(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
Anova(m8,test="Wald")
m8<-glm(AnyTip~ (poly(tlenkm,2)+Pickup_longitude)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
Anova(m8,test="Wald")
m81<-glm(AnyTip~ (poly(tlenkm,2)+Pickup_longitude)*(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
Anova(m81,test="Wald")
step(m8,  k=log(nrow(dffwork))
)
step(m8,  k=log(nrow(df)))
m8<-glm(AnyTip~ (poly(tlenkm,2)+Pickup_longitude)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
m82<-glm(AnyTip ~ (poly(tlenkm,2)+Pickup_longitude)+(f.MTA_tax+lpep_pickup_period+f.Extra)^2, family="binomial", data=train_dataset) # Interaccions dobles en factors
m83<-glm(AnyTip ~ (poly(tlenkm,2)+Pickup_longitude)*(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)  # Interaccions dobles en factor-numèrica
m84<-glm(AnyTip ~ (poly(tlenkm,2)+Pickup_longitude)*(f.MTA_tax+lpep_pickup_period+f.Extra)^2, family="binomial", data=train_dataset) # Interaccions dobles en factor-numèrica + dobles entre factors
m8<-glm(AnyTip~ (poly(tlenkm,2)+Pickup_longitude)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
m82<-glm(AnyTip ~ (poly(tlenkm,2)+Pickup_longitude)+(f.MTA_tax+lpep_pickup_period+f.Extra)^2, family="binomial", data=train_dataset) # Interaccions dobles en factors
m83<-glm(AnyTip ~ (poly(tlenkm,2)+Pickup_longitude)*(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)  # Interaccions dobles en factor-numèrica
m84<-glm(AnyTip ~ (poly(tlenkm,2)+Pickup_longitude)*(f.MTA_tax+lpep_pickup_period+f.Extra)^2, family="binomial", data=train_dataset) # Interaccions dobles en factor-numèrica + dobles entre factors
Anova(m82,test="Wald")
Anova(m83,test="Wald")
Anova(m82,test="Wald")
Anova(m83,test="Wald")
Anova(m82,test="Wald")
m8<-glm(AnyTip~ (poly(tlenkm,2)+Pickup_longitude)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
m82<-glm(AnyTip ~ (poly(tlenkm,2)+Pickup_longitude)+(f.MTA_tax+lpep_pickup_period+f.Extra)^2, family="binomial", data=train_dataset) # Interaccions dobles en factors
m83<-glm(AnyTip ~ (poly(tlenkm,2)+Pickup_longitude)*(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)  # Interaccions dobles en factor-numèrica
BIC(m8,m82,m83)
m8<-glm(AnyTip~ (poly(tlenkm,2)+Pickup_longitude)+(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)
m82<-glm(AnyTip ~ (poly(tlenkm,2)+Pickup_longitude)+(f.MTA_tax+lpep_pickup_period+f.Extra)^2, family="binomial", data=train_dataset) # Interaccions dobles en factors
m83<-glm(AnyTip ~ (poly(tlenkm,2)+Pickup_longitude)*(f.MTA_tax+lpep_pickup_period+f.Extra), family="binomial", data=train_dataset)  # Interaccions dobles en factor-numèrica
m9<- step(m8, k=log(nrow(df)))
m92<- step(m82, k=log(nrow(df)))
m93<- step(m83, k=log(nrow(df)))
BIC(m9,m92,m92)
BIC(m9,m92,m93)
m9<- step(m8, k=log(nrow(df)))
m9<- step(m8, k=log(nrow(df)))
m92<- step(m82, k=log(nrow(df)))
m92<- step(m82, k=log(nrow(df)))
m93<- step(m83, k=log(nrow(df)))
m92<- step(m82, k=log(nrow(df)))
m93<- step(m83, k=log(nrow(df)))
BIC(m9,m92,m93)
BIC(m8,m82,m83)
m90 <- m8
# Boxplot dels residus
Boxplot(rstudent(m90),id.n=15)
sout<-which(abs(rstudent(m90))>2.25);length(sout)
llout<-which(row.names(train_dataset) %in% names(rstudent(m90)[sout]));llout
train_dataset[llout,]
# Observacions potencialment influents
quantile(hatvalues(m90),seq(0,1,0.1))
mean(hatvalues(m90))
hh<-5*mean(hatvalues(m90));hh
shat<-which(hatvalues(m90)>hh);length(shat);shat
shat<-which(hatvalues(m90)>hh);length(shat);shat
llhat<-which(row.names(train_dataset) %in% names(rstudent(m90)[shat]));llhat
shat<-which(hatvalues(m90)>hh);length(shat);shat
llhat<-which(row.names(train_dataset) %in% names(rstudent(m90)[shat]));llhat
train_dataset[llhat,]
llhat<-which(row.names(train_dataset) %in% names(rstudent(m90)[shat]));llhat
train_dataset[llhat,]
Boxplot(cooks.distance(m90))
llhat<-which(row.names(train_dataset) %in% names(rstudent(m90)[shat]));llhat
train_dataset[llhat,]
Boxplot(cooks.distance(m90))
scoo<-which(cooks.distance(m90)>0.02);length(scoo);scoo
llhat<-which(row.names(train_dataset) %in% names(rstudent(m90)[shat]));llhat
train_dataset[llhat,]
Boxplot(cooks.distance(m90))
scoo<-which(cooks.distance(m90)>0.02);length(scoo);scoo
llcoo<-which(row.names(train_dataset) %in% names(cooks.distance(m90)[scoo]));llcoo
train_dataset[llhat,]
Boxplot(cooks.distance(m90))
scoo<-which(cooks.distance(m90)>0.02);length(scoo);scoo
llcoo<-which(row.names(train_dataset) %in% names(cooks.distance(m90)[scoo]));llcoo
llista<-influencePlot(m90,id=c(list="noteworthy",n=10))
train_dataset[llhat,]
Boxplot(cooks.distance(m90))
scoo<-which(cooks.distance(m90)>0.02);length(scoo);scoo
llcoo<-which(row.names(train_dataset) %in% names(cooks.distance(m90)[scoo]));llcoo
llista<-influencePlot(m90,id=c(list="noteworthy",n=10))
influencePlot(m90,id=c(list="noteworthy",n=10))
scoo<-which(cooks.distance(m90)>0.02);length(scoo);scoo
llcoo<-which(row.names(train_dataset) %in% names(cooks.distance(m90)[scoo]));llcoo
llista<-influencePlot(m90,id=c(list="noteworthy",n=10))
influencePlot(m90,id=c(list="noteworthy",n=10))
attributes(llista)
llista<-influencePlot(m90,id=c(list="noteworthy",n=10))
influencePlot(m90,id=c(list="noteworthy",n=10))
attributes(llista)
influenceIndexPlot(m90)
attributes(llista)
influenceIndexPlot(m90)
train_dataset[llcoo,]
influenceIndexPlot(m90)
train_dataset[llcoo,]
llfora1<-row.names(llista);llfora1;length(llfora1)
train_dataset[llcoo,]
llfora1<-row.names(llista);llfora1;length(llfora1)
ll<-which(row.names(train_dataset)%in%llfora1);ll;length(ll)
ll<-which(row.names(train_dataset)%in%llfora1);ll;length(ll)
df1<-train_dataset[-ll,]
llfora1<-row.names(llista);llfora1;length(llfora1)
ll<-which(row.names(train_dataset)%in%llfora1);ll;length(ll)
df1<-train_dataset[-ll,]
fit.AnyTip<-factor(ifelse(predict(m90,type="response")<0.5,0,1),labels=c("fit.No","fit.Yes"))
tt<-table(fit.AnyTip,df1$AnyTip);tt
