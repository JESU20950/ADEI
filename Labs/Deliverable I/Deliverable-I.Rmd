---
title: "Deliverable I"
author: 
- name: Jesús Molina Roldán
- name: Carles Capilla Cànovas
date: \today
output:
  word_document:
    toc: no
    toc_depth: '4'
  md_document:
  html_document:
    toc: no
    toc_depth: '4'
  pdf_document:
    number_sections: yes
    toc: yes
    toc_depth: '4'
geometry: left=1.9cm,right=1.9cm,top=1.25cm,bottom=1.52cm
fontsize: 18pt
subtitle: 'ADEI'
classoption: a4paper
editor_options: 
  chunk_output_type: console
---
## Data Description

This data dictionary describes SHL trip data. For dictionaries describing yellow taxi and FHV data, please visit http://www.nyc.gov/html/tlc/html/about/trip_record_data.shtml.

  - VendorID	A code indicating the LPEP provider that provided the record.      1= Creative Mobile Technologies, LLC; 2= VeriFone Inc.   
  - lpep_pickup_datetime	The date and time when the meter was engaged.    
  - lpep_dropoff_datetime	The date and time when the meter was disengaged.     
  - Passenger_count	The number of passengers in the vehicle. This is a driver-entered value.    -  Trip_distance 	The elapsed trip distance in miles reported by the taximeter.   
  - Pickup_longitude	 Longitude where the meter was engaged.   
  - Pickup_latitude	Latitude where the meter was engaged.   
  - RateCodeID	The final rate code in effect at the end of the trip.  1= Standard rate  2=JFK 3=Newark 4=Nassau or Westchester 5=Negotiated fare 6=Group ride   
  - Store_and_fwd_flag	This flag indicates whether the trip record was held in vehicle memory before sending to the vendor, aka "store and forward," because the vehicle did not have a connection to the server: Y= store and forward trip  N= not a store and forward trip   
  - Dropoff_longitude	Longitude where the meter was timed off.   
  - Dropoff_ latitude	Latitude where the meter was timed off.   
  - Payment_type	A numeric code signifying how the passenger paid for the trip.  1= Credit card 2= Cash 3= No charge 4= Dispute 5= Unknown 6= Voided trip   
  - Fare_amount	The time-and-distance fare calculated by the meter.   
  - Extra	 Miscellaneous extras and surcharges.  Currently, this only includes the $0.50 and $1 rush hour and overnight charges. 
  - MTA_tax	 $0.50 MTA tax that is automatically triggered based on the metered rate in use.    - Improvement_surcharge	$0.30 improvement surcharge assessed on hailed trips at the flag   drop. The improvement surcharge began being levied in 2015.   
  - Tip_amount	 This field is automatically populated for credit card tips. Cash tips are not included.   
  - Tolls_amount	Total amount of all tolls paid in trip.    
  - Total_amount	The total amount charged to passengers. Does not include cash tips.   
  - Trip_type	A code indicating whether the trip was a street-hail or a dispatch that is automatically assigned based on the metered rate in use but can be altered by the driver. 
1= Street-hail 2= Dispatch  

# Load Required Packages: to be increased over the course

```{r echo=T, results='hide', warning=FALSE}
options(contrasts=c("contr.treatment","contr.treatment"))

requiredPackages <- c("missMDA","chemometrics","mvoutlier","effects","FactoMineR","car", "factoextra","RColorBrewer","ggplot2","dplyr","ggmap","ggthemes","knitr")
missingPackages <- requiredPackages[!(requiredPackages %in% installed.packages()[,"Package"])]

if(length(missingPackages)) install.packages(missingPackages)
lapply(requiredPackages, require, character.only = TRUE)

```



```{r, echo=FALSE, results='FALSE'}
# Clear plots
if(!is.null(dev.list())) dev.off()

# Clean workspace
rm(list=ls())

#setwd("C:/Users/carle/Desktop/ADEI2")
#filepath<-"C:/Users/carle/Desktop/ADEI2/"
# green_tripdata_2016-01

setwd("~/Desktop/NYCABS")
filepath<-"~/Desktop/NYCABS/"
# green_tripdata_2016-01

df2<-read.table(paste0(filepath,"green_tripdata_2016-01.csv"),header=T, sep=",")
#Reload data
dim(df2)
names(df2)
head(df2)
```

## Select a sample of 5000 records

```{r, echo=TRUE, results=FALSE}
set.seed(02041997)
sam<-as.vector(sort(sample(1:nrow(df2),5000)))
df<-df2[sam,]
summary(df)
```

## Some useful functions

```{r, echo=TRUE, results=FALSE}
calcQ <- function(x) {
  s.x <- summary(x)
  iqr<-s.x[5]-s.x[2]
  list(souti=s.x[2]-3*iqr, mouti=s.x[2]-1.5*iqr, min=s.x[1], q1=s.x[2], q2=s.x[3], 
       q3=s.x[5], max=s.x[6], mouts=s.x[5]+1.5*iqr, souts=s.x[5]+3*iqr ) }

countNA <- function(x) {
  mis_x <- NULL
  for (j in 1:ncol(x)) {mis_x[j] <- sum(is.na(x[,j])) }
  mis_x <- as.data.frame(mis_x)
  rownames(mis_x) <- names(x)
  mis_i <- rep(0,nrow(x))
  for (j in 1:ncol(x)) {mis_i <- mis_i + as.numeric(is.na(x[,j])) }
  list(mis_col=mis_x,mis_ind=mis_i) }

countX <- function(x,X) {
  n_x <- NULL
  for (j in 1:ncol(x)) {n_x[j] <- sum(x[,j]==X) }
  n_x <- as.data.frame(n_x)
  rownames(n_x) <- names(x)
  nx_i <- rep(0,nrow(x))
  for (j in 1:ncol(x)) {nx_i <- nx_i + as.numeric(x[,j]==X) }
  list(nx_col=n_x,nx_ind=nx_i) }

EDA_Univariant <- function(x,title){
  if(missing(title)) {
        title<-""
  }
  x <- data.frame(x)
  print(summary(x))
  par(mfrow=c(NCOL(x),2))
  for (i in 1:NCOL(x)){
      if(NCOL(x)>1){
        title <-names(x)[i]
      }
      if (sapply(x, class)[i] == "numeric" || sapply(x, class)[i] == "integer"){
        print(sd(x[,i]))
        hist(x[,i], main = paste("Histogram", title), freq = TRUE, xlab="")
        boxplot(x[,i], main = paste("Boxplot", title))
        var_out<-calcQ(df$espeed)
        abline(h=var_out$souts,col="red")
        abline(h=var_out$souti,col="blue")
      }else{
        barplot(table(as.factor(x[,i])), main = paste("Barplot", names(x)[i]))
        pie(table(as.factor(x[,i])), main = paste("Pie", names(x)[i]))
      }
  }
  par(mfrow=c(1,1))
}

```

## Factors: Levels coding

Now codify properly factors and remove non-informative variables
```{r, echo=FALSE}
summary(df)
names(df)
df$VendorID<-factor(df$VendorID,labels=c("Mobile","VeriFone"))
levels(df$VendorID)<-paste0("f.Vendor-",levels(df$VendorID))
summary(df$VendorID)

df$Trip_type<-factor(df$Trip_type,labels=c("Street-Hail","Dispatch"))
levels(df$Trip_type)<-paste0("f.TripType-",levels(df$Trip_type))
summary(df$Trip_type)
nlevels(df$Trip_type)

df$Payment_type<-factor(df$Payment_type,labels=c("Credit card","Cash","No charge","Dispute"))
levels(df$Payment_type)<-paste0("f.PayType-",levels(df$Payment_type))
summary(df$Payment_type)
nlevels(df$Payment_type)

df_datatime <- t(as.data.frame(strsplit(as.character(df$lpep_pickup_datetime), " ")))
df$lpep_pickup_date <- factor(df_datatime[,1])
df$lpep_pickup_time <- factor(df_datatime[,2])


colnames(df)[which(names(df) == "Lpep_dropoff_datetime")] <- "lpep_dropoff_datetime"
df_datatime <- t(as.data.frame(strsplit(as.character(df$lpep_dropoff_datetime), " ")))
df$lpep_dropoff_date <- factor(df_datatime[,1])
df$lpep_dropoff_time <- factor(df_datatime[,2])

summary(df$Store_and_fwd_flag)
df$Store_and_fwd_flag <- df$Store_and_fwd_flag == "Y"

summary(df$improvement_surcharge)
colnames(df)[which(names(df) == "improvement_surcharge")] <- "Improvement_surcharge"


df$Ehail_fee<-NULL
```


```{r}
# Initialization of counts for missings, outliers and errors. All numerical variables have to be checked before

#######################################################
imis<-rep(0,nrow(df))  # rows - trips
jmis<-rep(0,2*ncol(df))  # columns - variables
######################################################
jmis <- colSums(is.na(df))
imis <- rowSums(is.na(df))
jmis
imis
#######################################################
iouts<-rep(0,nrow(df))  # rows outliers - trips
jouts<-rep(0,2*ncol(df))  # columns outliers - variables
######################################################

#######################################################
ierrs<-rep(0,nrow(df))  # rows errors - trips
jerrs<-rep(0,2*ncol(df))  # columns errors - variables
######################################################


```


## Univariant outliers and errors

```{r}
####   Variable RateCodeID. Consider Recoding to fewer levels
summary(df$RateCodeID)
df$RateCodeID<-factor(df$RateCodeID)
barplot(table(df$RateCodeID))

# It is a categorical(=factor) variable   NO PROBLEM but not any interest
df$RateCodeID <- df$RateCodeID != 1
df$RateCodeID <- factor(df$RateCodeID, labels=c("Standard rate","Others"))
summary(df$RateCodeID)
barplot(table(df$RateCodeID))

#Variable Passenger_count

hist(df$Passenger_count, main="Histogram of Passenger_count")
Boxplot(df$Passenger_count, main="Boxplot of Passenger_count")
summary(df$Passenger_count)

# errors
l <- which(df$Passenger_count<0)
if (length(l)>0) {
  ierrs[l]<-ierrs[l]+1
  jerrs["Passenger_count"]<-length(l)
}
df[l,"Passenger_count"]<-NA 


hist(df$Passenger_count, main="Histogram of Passenger_count")
Boxplot(df$Passenger_count, main="Boxplot of Passenger_count")
summary(df$Passenger_count)


#Variable Trip_distance
summary(df$Trip_distance)
#errors ->correct

#outliers
hist(df$Trip_distance, main="Histogram of Trip_distance")
Boxplot(df$Trip_distance, main="Boxplot of Trip_distance")
var_out<-calcQ(df$Trip_distance)
abline(h=var_out$souts,col="red")
abline(h=var_out$souti,col="blue")
l<-which(df$Trip_distance>20)
iouts[l]<-iouts[l]+1
jouts["Trip_distance"]<-length(l)



### Variable Pickup_latitude

summary(df$Pickup_latitude)
#0.00 looks to be an error
# Seeing the individuals with this "0" value:
df[which(df[,"Pickup_latitude"]==0),]

# It is a quantitive variable  Non-possible values will be recoded to NA
sel<-which(df$Pickup_latitude ==0)
ierrs[sel]<-ierrs[sel]+1
jerrs["Pickup_latitude"]<-length(sel)
sel                 #### sel contains the rownames of the individuals with "0" 
#                        as  value for longitude
df[sel,"Pickup_latitude"]<-NA    # non-possible values are replaced by NA, missing value symbol in R



####   Variable Store_and_fwd_flag
summary(df$Store_and_fwd_flag)
df$Store_and_fwd_flag<-factor(df$Store_and_fwd_flag)
barplot(table(df$Store_and_fwd_flag))
# It is a categorical(=factor) variable   NO PROBLEM but not any interest


### Variable Payment_type
summary(df$Payment_type)
frequency <- summary(df$Payment_type)
frequency <- frequency/sum(frequency)
frequency
barplot(frequency,ylim=c(0,1))
barplot(table(df$Payment_type))

l <- which(df$Payment_type != "f.PayType-Credit card" & df$Payment_type != "f.PayType-Cash" )
df$Payment_type <- as.character(df$Payment_type)
df[l,"Payment_type"] <- "Others"
df$Payment_type <- as.factor(df$Payment_type )
summary(df$Payment_type)
barplot(table(df$Payment_type))

## Variable Fare_amount
hist(df$Fare_amount, main="Histogram of Fare_amount")
Boxplot(df$Fare_amount, main="Boxplot of Fare_amount")
summary(df$Fare_amount)

# errors
l <- which(df$Fare_amount<0)
if (length(l)>0) {
  ierrs[l]<-ierrs[l]+1
  jerrs["Fare_amount"]<-length(l)
}
df[l,"Fare_amount"]<-NA 

# Outlier detection
Boxplot(df$Fare_amount)
var_out<-calcQ(df$Fare_amount)
abline(h=var_out$souts,col="red")
abline(h=var_out$souti,col="blue")
var_out$souts
l <-which(df$Fare_amount>80)
iouts[l ]<-iouts[l]+1
jouts["Fare_amount"]<-length(l)
df[l,"Fare_amount"]<-NA 

hist(df$Fare_amount, main="Histogram of Fare_amount")
Boxplot(df$Fare_amount, main="Boxplot of Fare_amount")
summary(df$Fare_amount)

## Variable Extra

hist(df$Extra, main="Histogram of Extra")
Boxplot(df$Extra, main="Boxplot of Extra")
summary(df$Extra)

# errors
l <- which(df$Extra<0)
if (length(l)>0) {
  ierrs[l]<-ierrs[l]+1
  jerrs["Extra"]<-length(l)
}
df[l,"Extra"]<-NA 

# Outlier detection
Boxplot(df$Extra)
var_out<-calcQ(df$Extra)
abline(h=var_out$souts,col="red")
abline(h=var_out$souti,col="blue")
var_out$souts
#No outliers

### Variable MTA_tax
hist(df$MTA_tax, main="Histogram of MTA_tax")
Boxplot(df$MTA_tax, main="Boxplot of MTA_tax")
summary(df$MTA_tax)

# errors
l <- which(df$MTA_tax<0)
if (length(l)>0) {
  ierrs[l]<-ierrs[l]+1
  jerrs["MTA_tax"]<-length(l)
}
df[l,"MTA_tax"]<-NA 

df[,"MTA_tax"] <- df[,"MTA_tax"] == 0.5
barplot(table(df[,"MTA_tax"]))
summary(df[,"MTA_tax"] )

#it is not a useful information because in theory it is always 0.5$.

### Variable Improvement_surcharge
hist(df$Improvement_surcharge, main="Histogram of Improvement_surcharge")
Boxplot(df$Improvement_surcharge, main="Boxplot of Improvement_surcharge")
summary(df$Improvement_surcharge)

# errors
l <- which(df$Improvement_surcharge<0)
if (length(l)>0) {
  ierrs[l]<-ierrs[l]+1
  jerrs["Improvement_surcharge"]<-length(l)
}
df[l,"Improvement_surcharge"]<-NA 
df[,"Improvement_surcharge"] <- df[,"Improvement_surcharge"] == 0.3
barplot(table(df[,"Improvement_surcharge"]))
summary(df[,"Improvement_surcharge"] )

#it is not a useful information because in theory it is always 0.3$.

# Variable Tip_amount
hist(df$Tip_amount, main="Histogram of Tip_amount")
Boxplot(df$Tip_amount, main="Boxplot of Tip_amount")
summary(df$Tip_amount)

# errors
l <- which(df$Tip_amount<0)
if (length(l)>0) {
  ierrs[l]<-ierrs[l]+1
  jerrs["Tip_amount"]<-length(l)
}
df[l,"Tip_amount"]<-NA 

# Outlier detection
Boxplot(df$Tip_amount)
var_out<-calcQ(df$Tip_amount)
abline(h=var_out$souts,col="red")
abline(h=var_out$souti,col="blue")
var_out$souts
l <-which(df$Tip_amount>20)
iouts[l ]<-iouts[l]+1
jouts["Tip_amount"]<-length(l)
df[l,"Tip_amount"]<-NA 

hist(df$Tip_amount, main="Histogram of Tip_amount")
Boxplot(df$Tip_amount, main="Boxplot of Tip_amount")
summary(df$Tip_amount)


### Variable Tolls_amount

hist(df$Tolls_amount, main="Histogram of Tolls_amount")
Boxplot(df$Tolls_amount, main="Boxplot of Tolls_amount")
summary(df$Tolls_amount)

# errors
l <- which(df$Tolls_amount<0)
if (length(l)>0) {
  ierrs[l]<-ierrs[l]+1
  jerrs["Tolls_amount"]<-length(l)
}
df[l,"Tolls_amount"]<-NA 

# Outlier detection
Boxplot(df$Tolls_amount)
var_out<-calcQ(df$Tolls_amount)
abline(h=var_out$souts,col="red")
abline(h=var_out$souti,col="blue")
var_out$souts
l <-which(df$Tolls_amount>7)
iouts[l ]<-iouts[l]+1
jouts["Tolls_amount"]<-length(l)
df[l,"Tolls_amount"]<-NA 

hist(df$Tolls_amount, main="Histogram of Tolls_amount")
Boxplot(df$Tolls_amount, main="Boxplot of Tolls_amount")
summary(df$Tolls_amount)


### Variable Total_amount

#errors

summary(df$Total_amount)
l<-which(df$Total_amount<0)
if (length(l)>0) {
  ierrs[l]<-ierrs[l]+1
  jerrs["Total_amount"]<-length(l)
}
df[l,"Total_amount"]<-NA

# Outlier detection
Boxplot(df$Total_amount)
var_out<-calcQ(df$Total_amount)
abline(h=var_out$souts,col="red")
abline(h=var_out$souti,col="blue")
l<-which((df$Total_amount<0)|(df$Total_amount>100))
iouts[l]<-iouts[l]+1
jouts["Total_amount"]<-length(l)
df[l,"Total_amount"]<-NA 


```




## Imputation of qualitative variables

```{r}
#MCA no es necesario ya que no hay variables categoricas con nulos.

#vars_dis <- c("VendorID","lpep_pickup_datetime", "lpep_dropoff_datetime", "RateCodeID","Payment_type", "Store_and_fwd_flag", "lpep_pickup_period", "lpep_dropoff_period", "Trip_type", "lpep_pickup_period", "lpep_dropoff_period")

#summary(df[,vars_dis])
#res.immca<-imputeMCA(df[,vars_dis],ncp=10)
#summary(res.immca$completeObs)

# Check one by one
#df[ , vars_dis]<-res.immca$completeObs  

```


## Imputation of numeric variables

```{r}
names(df)
summary(df)
#vars_con
vars_con <- c( "Passenger_count", "Trip_distance", "Pickup_longitude", "Pickup_latitude", "Dropoff_longitude", "Dropoff_latitude","Fare_amount", "Extra", "MTA_tax", "Improvement_surcharge", "Tip_amount", "Tolls_amount", "Total_amount")

summary(df[,vars_con])
res.impca<-imputePCA(df[,vars_con],ncp=10)
summary(res.impca$completeObs)


df[ ,vars_con]<-res.impca$completeObs
summary(df[,vars_con])
```



## Multivariant Outliers

```{r}
vars_con <- c( "Trip_distance","Fare_amount", "Total_amount")
summary(df[,vars_con])
aq.plot(df[,vars_con],delta=qchisq(0.995,length(vars_con)),quan=0.75)
mout<-Moutlier(df[,vars_con],quantile = 0.995, plot = TRUE)
par(mfrow=c(1,1))
plot(mout$md,mout$rd, type="n")
text(mout$md,mout$rd,labels=vars_con)

Boxplot(mout$rd)
summary(mout$rd)
l<-which(mout$rd>50);length(l)
df <- df[-l,]
```

## Define new variables

Create new variables derived from the original ones, as effective speed, travel time, hour of request, period of request, effective trip distance (in km) 

```{r}
# New variables

# Trip length in km
df$tlenkm<-df$Trip_distance*1.609344 # Miles to km
# Travel time in min
df$traveltime<-(as.numeric(as.POSIXct(df$lpep_dropoff_datetime)) - as.numeric(as.POSIXct(df$lpep_pickup_datetime)))/60


# Effective speed (km/h)
df$espeed<-(df$tlenkm/(df$traveltime))*60

# Missing data
l<-which(is.na(df$espeed));length(l)
imis[l]<-imis[l]+1
jmis["espeed"]<-length(l)

# Error detection
summary(df$espeed)
l<-which((df$espeed<=0)|(df$espeed=="Inf"))
ierrs[l]<-ierrs[l]+1
jerrs["espeed"]<-length(l)
df[l,"espeed"]<-NA 

# Check outliers
summary(df$espeed)
calcQ(df$espeed)
# Outlier detection
Boxplot(df$espeed)
var_out<-calcQ(df$espeed)
abline(h=var_out$souts,col="red")
abline(h=var_out$souti,col="blue")

llout<-which((df$espeed<=3)|(df$espeed>240))
iouts[llout]<-iouts[llout]+1
jouts["espeed"]<-length(llout)
df[llout,"espeed"]<-NA 


df$lpep_pickup_hour<-as.numeric(substr(strptime(df$lpep_pickup_datetime, "%Y-%m-%d %H:%M:%S"),12,13))
df$lpep_pickup_period<-1
df$lpep_pickup_period[df$lpep_pickup_hour>7]<-2
df$lpep_pickup_period[df$lpep_pickup_hour>10]<-3
df$lpep_pickup_period[df$lpep_pickup_hour>16]<-4
df$lpep_pickup_period[df$lpep_pickup_hour>19]<-1
df$lpep_pickup_period<-factor(df$lpep_pickup_period,labels=paste("Period",c("night","morning","valley","afternoon")))
df$lpep_dropoff_hour<-as.numeric(substr(strptime(df$lpep_dropoff_datetime, "%Y-%m-%d %H:%M:%S"),12,13))
df$lpep_dropoff_period<-1
df$lpep_dropoff_period[df$lpep_dropoff_hour>7]<-2
df$lpep_dropoff_period[df$lpep_dropoff_hour>10]<-3
df$lpep_dropoff_period[df$lpep_dropoff_hour>16]<-4
df$lpep_dropoff_period[df$lpep_dropoff_hour>19]<-1
df$lpep_dropoff_period<-factor(df$lpep_dropoff_period,labels=paste("Period",c("night","morning","valley","afternoon")))


library(geosphere) 
df$distHaversine <-distHaversine(df[,c("Pickup_longitude", "Pickup_latitude")],
              df[,c("Dropoff_longitude", "Dropoff_latitude")])/1000

```

## Discretization 

```{r}
####    Discretization of all variables

## Variable espeed

summary(df[,vars_con])

varaux<-factor(cut(df$espeed,breaks=quantile(df$espeed,seq(0,1,0.1),na.rm=TRUE),include.lowest = T ))
summary(varaux)
tapply(df$espeed,varaux,median)  #tapply(X, INDEX, FUN = NULL) map function
df$f.espeed<-factor(cut(df$espeed,breaks=quantile(df$espeed,seq(0,1,0.1),na.rm=TRUE),include.lowest = T ))
levels(df$f.espeed)<-paste("f.espeed-",levels(df$f.espeed),sep="")

## Variable Trip_distance

varaux<-factor(cut(df$Trip_distance,breaks=quantile(df$Trip_distance,seq(0,1,0.25),na.rm=TRUE),include.lowest = T ))
summary(varaux)
tapply(df$Trip_distance,varaux,median)  #tapply(X, INDEX, FUN = NULL) map function
df$f.Trip_distance<-factor(cut(df$Trip_distance,breaks=quantile(df$Trip_distance,seq(0,1,0.25),na.rm=TRUE),include.lowest = T ))
levels(df$f.Trip_distance)<-paste("f.Trip_distance-",levels(df$f.Trip_distance),sep="")

## Variable tlenkm
summary(df$tlenkm)
varaux<-factor(cut(df$tlenkm,breaks=quantile(df$tlenkm,seq(0,1,0.25),na.rm=TRUE),include.lowest = T ))
summary(varaux)
df$f.tlenkm<-factor(ifelse(df$tlenkm<6, "f.tlenkm-short", "f.tlenkm-long"))
summary(df$f.tlenkm)

## Variable traveltime
summary(df$traveltime)
varaux<-factor(cut(df$traveltime,breaks=c(0,5,40,max(df$traveltime)),include.lowest = T ))
summary(varaux)
df$f.traveltime <- varaux
levels(df$f.traveltime)<-paste("f.traveltime-",levels(df$f.traveltime),sep="")

## Variable distHaversine

varaux<-factor(cut(df$distHaversine,breaks=quantile(df$distHaversine,seq(0,1,0.25),na.rm=TRUE),include.lowest = T ))
summary(varaux)
tapply(df$distHaversine,varaux,median)  #tapply(X, INDEX, FUN = NULL) map function
df$f.distHaversine<-factor(cut(df$distHaversine,breaks=quantile(df$distHaversine,seq(0,1,0.25),na.rm=TRUE),include.lowest = T ))
levels(df$f.distHaversine)<-paste("f.distHaversine-",levels(df$f.distHaversine),sep="")

# Variable Tolls_amount
Boxplot(df$Tolls_amount)
varaux<-factor(cut(df$Tolls_amount,breaks=c(0,0.01,max(df$Tolls_amount)),include.lowest = T ))
df$AnyToll <- df$Tolls_amount < 0.01
df$AnyToll<-factor(df$AnyToll,labels=paste("AnyToll",c("No","Yes")))
summary(df$AnyToll)  


## Variable Tip_amount

df$AnyTip<-ifelse(df$Tip_amount<0.01,0,1)
df$AnyTip<-factor(df$AnyTip,labels=paste("AnyTip",c("No","Yes")))
summary(df$AnyTip)
# Pie
piepercent<-round(100*(table(df$AnyTip)/nrow(df)),dig=2); piepercent
pie(table(df$AnyTip),col=heat.colors(2),labels=paste(piepercent,"%"))
legend("topright", levels(df$AnyTip), cex = 0.8, fill = heat.colors(2))
# Bar Chart
barplot(table(df$AnyTip),main="Barplot Final Decision Factor",col=c("green","red"))

```

## Data Quality report (missings/errors/outliers) and remove observations with missings in targets

```{r}



```

## Univariant Exploratory Analysis (EDA)

```{r}
EDA_Univariant(df[,vars_con[1]])
```


## Profiling

```{r}

# res.condes<-condes(df,which(names(df)=="Total_amount"))  # Takes a lot
#res.condes<-condes(df[,c(vars_res,vars_con,vars_dis)],1)

#res.condes$quanti  # Global association to numeric variables
#res.condes$quali # Global association to factors
#res.condes$category  # Partial association to significative levels in factors




```


